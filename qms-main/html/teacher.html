<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizPro - Teacher Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS Variables */
        :root {
            --primary: #4a6baf;
            --primary-dark: #3a5599;
            --secondary: #6c87c7;
            --accent: #ff9e43;
            --light: #f5f7fa;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --white: #ffffff;
            --error: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --info: #3498db;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --sidebar-width: 280px;
            --sidebar-collapsed-width: 70px;
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --light: #2c3e50;
            --dark: #ecf0f1;
            --white: #34495e;
            --gray: #bdc3c7;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            display: flex;
            min-height: 100vh;
            transition: var(--transition);
            line-height: 1.6;
        }

        /* Header Styles */
        .dashboard-header {
            position: fixed;
            top: 0;
            left: var(--sidebar-width);
            right: 0;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            z-index: 100;
            transition: var(--transition);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-title {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .header-breadcrumb {
            font-size: 0.9rem;
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-notification {
            position: relative;
            cursor: pointer;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .header-user {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a6baf 0%, #6c87c7 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Sidebar Styles */
        .dashboard-sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 0;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow);
            z-index: 10;
            position: fixed;
            height: 100vh;
            overflow: hidden;
            transition: var(--transition);
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h2 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.4rem;
            font-weight: 700;
        }

        .close-sidebar {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .profile-card {
            padding: 25px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .profile-icon {
            font-size: 3.5rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 15px;
        }

        .profile-card h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .profile-card p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 25px;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.8);
            transition: var(--transition);
            border-left: 4px solid transparent;
            font-weight: 500;
        }

        .sidebar-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .sidebar-link.active {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            border-left-color: var(--accent);
        }

        .sidebar-link i {
            width: 20px;
            text-align: center;
        }

        .sidebar-link-text {
            transition: var(--transition);
        }

        .logout-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 25px;
            background-color: rgba(239, 68, 68, 0.2);
            color: white;
            text-decoration: none;
            transition: var(--transition);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 500;
        }

        .logout-link:hover {
            background-color: rgba(239, 68, 68, 0.3);
        }

        /* Main Content Styles */
        .dashboard-content {
            flex: 1;
            padding: 100px 30px 30px;
            margin-left: var(--sidebar-width);
            overflow-y: auto;
            transition: var(--transition);
        }

        .greeting-message {
            color: var(--dark);
            margin-bottom: 30px;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .content-section {
            display: none;
        }

        .content-section.active-content {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Dashboard Cards */
        .dashboard-card {
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 30px;
            transition: var(--transition);
        }

        .dashboard-card h2 {
            color: var(--dark);
            margin-bottom: 25px;
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white);
            border-radius: 10px;
            padding: 25px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
        }

        /* Action Bar */
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            gap: 15px;
        }

        .input-filter {
            flex: 1;
            max-width: 400px;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--white);
            color: var(--dark);
        }

        .input-filter:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        /* Buttons */
        .add-btn,
        .edit-btn,
        .delete-btn,
        .save-btn,
        .cancel-btn,
        .publish-btn,
        .draft-btn,
        .assign-btn,
        .view-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-btn {
            background-color: var(--success);
            color: white;
        }

        .add-btn:hover {
            background-color: #0d9c6b;
            transform: translateY(-2px);
        }

        .edit-btn {
            background-color: var(--primary);
            color: white;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .delete-btn {
            background-color: var(--error);
            color: white;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .save-btn {
            background-color: var(--success);
            color: white;
        }

        .cancel-btn {
            background-color: var(--gray);
            color: white;
        }

        .publish-btn {
            background-color: var(--success);
            color: white;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .draft-btn {
            background-color: var(--warning);
            color: white;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .assign-btn {
            background-color: var(--info);
            color: white;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .view-btn {
            background-color: var(--accent);
            color: white;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        /* Tables */
        .table-responsive {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--white);
            color: var(--dark);
            min-width: 600px;
        }

        .data-table th {
            background-color: #f8fafc;
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid #e2e8f0;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 1px 0 #e2e8f0;
        }

        .data-table td {
            padding: 16px 20px;
            border-bottom: 1px solid #e2e8f0;
            white-space: nowrap;
        }

        .data-table tr:hover {
            background-color: rgba(59, 130, 246, 0.05);
        }

        /* Status Badges - REMOVED since we don't need status */
        .action-buttons {
            display: flex;
            gap: 8px;
            white-space: nowrap;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard-sidebar {
                width: 240px;
            }

            .dashboard-header {
                left: 240px;
            }

            .dashboard-content {
                margin-left: 240px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }

            .dashboard-sidebar {
                transform: translateX(-100%);
                width: 280px;
            }

            .dashboard-sidebar.mobile-open {
                transform: translateX(0);
            }

            .dashboard-header {
                left: 0;
            }

            .dashboard-content {
                margin-left: 0;
                padding: 100px 20px 20px;
            }

            .close-sidebar {
                display: block;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .action-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .input-filter {
                max-width: 100%;
            }

            .action-buttons {
                flex-direction: column;
                gap: 8px;
            }
        }

        @media (max-width: 480px) {
            .dashboard-content {
                padding: 100px 15px 15px;
            }

            .dashboard-card {
                padding: 20px;
            }

            .header-title {
                font-size: 1.2rem;
            }

            .modal-header {
                padding: 15px;
            }

            .modal-header h3 {
                font-size: 1.1rem;
            }

            .modal-body {
                padding: 15px;
            }

            .modal-footer {
                flex-direction: column;
                gap: 10px;
            }

            .modal-footer .cancel-btn,
            .modal-footer .save-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Hide scrollbar but keep scrolling functionality */
        .dashboard-sidebar,
        .sidebar-nav {
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .dashboard-sidebar::-webkit-scrollbar,
        .sidebar-nav::-webkit-scrollbar {
            display: none;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 85vh;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            animation: modalSlideIn 0.3s ease-out;
            display: flex;
            flex-direction: column;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .modal-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
            max-height: calc(85vh - 130px);
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            flex-shrink: 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--white);
            color: var(--dark);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        /* Hidden class */
        .hidden-content {
            display: none !important;
        }

        /* Questions Styles */
        .questions-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .question-item {
            background: var(--white);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e2e8f0;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        .question-header h4 {
            margin: 0;
            color: var(--dark);
        }

        .question-actions {
            display: flex;
            gap: 8px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .option {
            padding: 10px;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .option.correct {
            background-color: #d1fae5;
            border-color: #10b981;
            color: #065f46;
            font-weight: 600;
        }

        .question-item p {
            margin: 0 0 10px 0;
            line-height: 1.5;
        }
    </style>
</head>

<body class="dashboard-body">

    <!-- Header -->
    <div class="dashboard-header">
        <div class="header-left">
            <button class="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-title" id="header-title">Teacher Dashboard</div>
            <div class="header-breadcrumb">
                <i class="fas fa-home"></i>
                <span>Teacher</span>
                <i class="fas fa-chevron-right"></i>
                <span id="breadcrumb-current">Overview</span>
            </div>
        </div>
        <div class="header-right">
            <div class="header-user">
                <div class="user-avatar" id="user-avatar">JD</div>
                <div class="user-info">
                    <div class="user-name" id="header-user-name">Loading...</div>
                    <div class="user-role" id="header-user-role">Teacher</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="dashboard-sidebar">
        <div class="sidebar-header">
            <h2><i class="fas fa-chalkboard-teacher"></i> <span>QuizPro Teacher</span></h2>
            <button class="close-sidebar"><i class="fas fa-times"></i></button>
        </div>

        <div class="profile-card">
            <i class="fas fa-user-tie profile-icon"></i>
            <h3 id="teacher-name-display">Loading...</h3>
            <p id="teacher-subject-display">Teacher</p>
        </div>

        <nav class="sidebar-nav">
            <a href="#overview" class="sidebar-link active" data-content="overview">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard Overview</span>
            </a>
            <a href="#my-quizzes" class="sidebar-link" data-content="my-quizzes">
                <i class="fas fa-list-check"></i>
                <span>All Quizzes</span>
            </a>
            <a href="#my-students" class="sidebar-link" data-content="my-students">
                <i class="fas fa-users"></i>
                <span>My Students</span>
            </a>
            <a href="#question-bank" class="sidebar-link" data-content="question-bank">
                <i class="fas fa-database"></i>
                <span>Question Bank</span>
            </a>
            <a href="#settings" class="sidebar-link" data-content="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </nav>

        <a href="#" id="logout-link" class="logout-link">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
        </a>
    </div>

    <!-- Main Content -->
    <div class="dashboard-content">

        <!-- Overview Section -->
        <div id="overview" class="content-section dashboard-card active-content">
            <h2><i class="fas fa-tachometer-alt"></i> Teacher Dashboard</h2>
            <div class="greeting-message" id="greeting-message">Welcome back!</div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Available Quizzes</h3>
                    <div class="stat-value" id="active-quizzes-count">0</div>
                </div>

                <div class="stat-card">
                    <h3>Total Students</h3>
                    <div class="stat-value" id="total-students-count">0</div>
                </div>

                <div class="stat-card">
                    <h3>Total Questions</h3>
                    <div class="stat-value" id="total-questions-count">0</div>
                </div>

               
            </div>

            <h3>Recent Activity</h3>
            <div id="recent-activity-log" class="activity-log">
                <div class="activity-item">
                    <div class="activity-icon" style="background-color: var(--primary);">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-text">Loading recent activities...</div>
                        <div class="activity-time">Just now</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- My Quizzes Section -->
        <div id="my-quizzes" class="content-section dashboard-card hidden-content">
            <h2><i class="fas fa-list-check"></i> All Quizzes</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Quizzes</h3>
                    <div class="stat-value" id="published-quizzes-count">0</div>
                </div>

                <div class="stat-card">
                    <h3>Total Questions</h3>
                    <div class="stat-value" id="quiz-questions-count">0</div>
                </div>
            </div>

            <div class="action-bar">
                <input type="text" id="quiz-search" placeholder="Search quizzes by title..." class="input-filter">
                <button id="add-quiz-btn" class="add-btn">
                    <i class="fas fa-plus"></i> Create New Quiz
                </button>
            </div>

            <div class="table-responsive">
                <table class="data-table quiz-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Subject</th>
                            <th>Total Questions</th>
                            <th>Total Marks</th>
                            <th>Time Limit</th>
                            <th>Created At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="quiz-table-body">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 30px;">
                                <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem;"></i>
                                    <span>Loading quizzes...</span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- My Students Section -->
        <div id="my-students" class="content-section dashboard-card hidden-content">
            <h2><i class="fas fa-users"></i> My Students</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Students</h3>
                    <div class="stat-value" id="students-count">0</div>
                </div>

                <div class="stat-card">
                    <h3>Active This Week</h3>
                    <div class="stat-value" id="active-students-count">0</div>
                </div>
 
            </div>

            <div class="action-bar">
                <input type="text" id="student-search" placeholder="Search students by name or email..." class="input-filter">
            </div>

            <div class="table-responsive">
                <table class="data-table student-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Last Active</th>
                        </tr>
                    </thead>
                    <tbody id="student-table-body">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 30px;">
                                <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem;"></i>
                                    <span>Loading students...</span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Question Bank Section -->
        <div id="question-bank" class="content-section dashboard-card hidden-content">
            <h2><i class="fas fa-database"></i> Question Bank</h2>

            <div class="action-bar">
                <input type="text" id="question-search" placeholder="Search questions..." class="input-filter">
                <button id="add-question-btn" class="add-btn">
                    <i class="fas fa-plus"></i> Add New Question
                </button>
            </div>

            <div class="table-responsive">
                <table class="data-table question-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Question Text</th>
                            <th>Created At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="question-table-body">
                        <tr>
                            <td colspan="4" style="text-align: center; padding: 30px;">
                                <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem;"></i>
                                    <span>Loading questions...</span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings" class="content-section dashboard-card hidden-content">
            <h2><i class="fas fa-cog"></i> Teacher Settings</h2>

            <div class="settings-grid" id="settings-grid">
                <div class="setting-card">
                    <div class="setting-title">
                        <i class="fas fa-palette"></i> Theme
                    </div>
                    <div class="setting-description">
                        Choose your preferred interface theme
                    </div>
                    <select id="theme-select" class="input-filter">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="auto">Auto (System)</option>
                    </select>
                </div>

                <div class="setting-card">
                    <div class="setting-title">
                        <i class="fas fa-bell"></i> Notifications
                    </div>
                    <div class="setting-description">
                        Manage how you receive notifications
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notif-quiz-submissions" checked> Quiz Submissions
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notif-student-questions" checked> Student Questions
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notif-system-updates"> System Updates
                        </label>
                    </div>
                </div>

                <div class="setting-card">
                    <div class="setting-title">
                        <i class="fas fa-language"></i> Language
                    </div>
                    <div class="setting-description">
                        Select your preferred language
                    </div>
                    <select id="language-select" class="input-filter">
                        <option value="en">English</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                    </select>
                </div>
            </div>

            <div class="action-bar" style="margin-top: 30px;">
                <button class="cancel-btn" id="cancel-settings-btn">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="save-btn" id="save-settings-btn">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>
        </div>

    </div>

    <!-- Create Quiz Modal -->
    <div id="add-quiz-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Quiz</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-quiz-form">
                    <div class="form-group">
                        <label for="quiz-title">Quiz Title *</label>
                        <input type="text" id="quiz-title" placeholder="Enter quiz title" required>
                    </div>
                    <div class="form-group">
                        <label for="quiz-subject">Subject *</label>
                        <input type="text" id="quiz-subject" placeholder="e.g., Mathematics, Science, etc." required>
                    </div>
                    <div class="form-group">
                        <label for="quiz-total-questions">Total Questions</label>
                        <input type="number" id="quiz-total-questions" placeholder="e.g., 10" min="1" value="10">
                    </div>
                    <div class="form-group">
                        <label for="quiz-total-marks">Total Marks</label>
                        <input type="number" id="quiz-total-marks" placeholder="e.g., 100" min="1" value="100">
                    </div>
                    <div class="form-group">
                        <label for="quiz-time-limit">Time Limit (minutes)</label>
                        <input type="number" id="quiz-time-limit" placeholder="e.g., 60" min="1" value="60">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn">Cancel</button>
                <button class="save-btn">Create Quiz</button>
            </div>
        </div>
    </div>

    <!-- Edit Quiz Modal -->
    <div id="edit-quiz-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Quiz</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-quiz-form">
                    <input type="hidden" id="edit-quiz-id">
                    <div class="form-group">
                        <label for="edit-quiz-title">Quiz Title *</label>
                        <input type="text" id="edit-quiz-title" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-quiz-subject">Subject *</label>
                        <input type="text" id="edit-quiz-subject" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-quiz-total-questions">Total Questions</label>
                        <input type="number" id="edit-quiz-total-questions" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-quiz-total-marks">Total Marks</label>
                        <input type="number" id="edit-quiz-total-marks" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-quiz-time-limit">Time Limit (minutes)</label>
                        <input type="number" id="edit-quiz-time-limit" min="1" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn">Cancel</button>
                <button class="save-btn">Update Quiz</button>
            </div>
        </div>
    </div>

    <!-- Delete Quiz Modal -->
    <div id="delete-quiz-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Delete Quiz</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong id="delete-quiz-title">this quiz</strong>?
                    All questions associated with this quiz will also be deleted.</p>
                <input type="hidden" id="delete-quiz-id">
            </div>
            <div class="modal-footer">
                <button class="cancel-btn">Cancel</button>
                <button class="delete-btn">Delete Quiz</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Question Modal -->
    <div id="question-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 id="question-modal-title">Add Question</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="question-form">
                    <input type="hidden" id="question-id">
                    <input type="hidden" id="question-quiz-id">

                    <div class="form-group">
                        <label for="question-text">Question Text *</label>
                        <textarea id="question-text" rows="3" placeholder="Enter the question..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="option-a">Option A *</label>
                        <input type="text" id="option-a" placeholder="Enter option A" required>
                    </div>

                    <div class="form-group">
                        <label for="option-b">Option B *</label>
                        <input type="text" id="option-b" placeholder="Enter option B" required>
                    </div>

                    <div class="form-group">
                        <label for="option-c">Option C</label>
                        <input type="text" id="option-c" placeholder="Enter option C (optional)">
                    </div>

                    <div class="form-group">
                        <label for="option-d">Option D</label>
                        <input type="text" id="option-d" placeholder="Enter option D (optional)">
                    </div>

                    <div class="form-group">
                        <label for="correct-option">Correct Option *</label>
                        <select id="correct-option" required>
                            <option value="">Select correct option</option>
                            <option value="a">Option A</option>
                            <option value="b">Option B</option>
                            <option value="c">Option C</option>
                            <option value="d">Option D</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn">Cancel</button>
                <button class="save-btn" id="save-question-btn">Save Question</button>
            </div>
        </div>
    </div>

    <!-- Manage Questions Modal -->
    <div id="manage-questions-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Manage Questions: <span id="quiz-title-display"></span></h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="action-bar">
                    <button id="add-quiz-question-btn" class="add-btn">
                        <i class="fas fa-plus"></i> Add Question
                    </button>
                </div>

                <div id="questions-container">
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; margin-bottom: 10px;"></i>
                        <p>Loading questions...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn">Close</button>
            </div>
        </div>
    </div>
<!-- Add Student Modal -->
<div id="add-student-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add New Student</h3>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <form id="add-student-form">
                <div class="form-group">
                    <label for="student-name">Full Name *</label>
                    <input type="text" id="student-name" placeholder="Enter student's full name" required>
                </div>
                <div class="form-group">
                    <label for="student-email">Email Address *</label>
                    <input type="email" id="student-email" placeholder="Enter student's email" required>
                </div>
                <div class="form-group">
                    <label for="student-password">Password *</label>
                    <input type="password" id="student-password" placeholder="Enter password (min. 6 characters)" required>
                </div>
                <div class="form-group">
                    <label for="student-phone">Phone Number</label>
                    <input type="tel" id="student-phone" placeholder="Enter phone number">
                </div>
                <div class="form-group">
                    <label for="student-class">Class/Group</label>
                    <select id="student-class" class="input-filter">
                        <option value="">Select Class</option>
                        <option value="Grade 9-A">Grade 9-A</option>
                        <option value="Grade 9-B">Grade 9-B</option>
                        <option value="Grade 10-A">Grade 10-A</option>
                        <option value="Grade 10-B">Grade 10-B</option>
                        <option value="Grade 11-A">Grade 11-A</option>
                        <option value="Grade 11-B">Grade 11-B</option>
                        <option value="Grade 12-A">Grade 12-A</option>
                        <option value="Grade 12-B">Grade 12-B</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="cancel-btn">Cancel</button>
            <button class="save-btn" id="save-student-btn">Add Student</button>
        </div>
    </div>
</div>

<!-- Edit Student Modal -->
<div id="edit-student-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Edit Student</h3>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <form id="edit-student-form">
                <input type="hidden" id="edit-student-id">
                <div class="form-group">
                    <label for="edit-student-name">Full Name *</label>
                    <input type="text" id="edit-student-name" required>
                </div>
                <div class="form-group">
                    <label for="edit-student-email">Email Address *</label>
                    <input type="email" id="edit-student-email" required>
                </div>
                <div class="form-group">
                    <label for="edit-student-password">Password (leave blank to keep current)</label>
                    <input type="password" id="edit-student-password" placeholder="Enter new password">
                </div>
                <div class="form-group">
                    <label for="edit-student-phone">Phone Number</label>
                    <input type="tel" id="edit-student-phone">
                </div>
                <div class="form-group">
                    <label for="edit-student-class">Class/Group</label>
                    <select id="edit-student-class" class="input-filter">
                        <option value="">Select Class</option>
                        <option value="Grade 9-A">Grade 9-A</option>
                        <option value="Grade 9-B">Grade 9-B</option>
                        <option value="Grade 10-A">Grade 10-A</option>
                        <option value="Grade 10-B">Grade 10-B</option>
                        <option value="Grade 11-A">Grade 11-A</option>
                        <option value="Grade 11-B">Grade 11-B</option>
                        <option value="Grade 12-A">Grade 12-A</option>
                        <option value="Grade 12-B">Grade 12-B</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-student-status">Status</label>
                    <select id="edit-student-status" class="input-filter">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="cancel-btn">Cancel</button>
            <button class="save-btn" id="update-student-btn">Update Student</button>
        </div>
    </div>
</div>

<!-- Delete Student Modal -->
<div id="delete-student-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Delete Student</h3>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete <strong id="delete-student-name">this student</strong>?</p>
            <p style="color: var(--error); font-size: 0.9rem; margin-top: 10px;">
                <i class="fas fa-exclamation-triangle"></i> This action cannot be undone.
            </p>
            <input type="hidden" id="delete-student-id">
        </div>
        <div class="modal-footer">
            <button class="cancel-btn">Cancel</button>
            <button class="delete-btn" id="confirm-delete-student-btn">Delete Student</button>
        </div>
    </div>
</div>
    <script>
        // ===============================
        // Authentication & User Display Functions
        // ===============================

        // Check authentication
        function checkAuth() {
            const userRole = localStorage.getItem('user_role');
            const userName = localStorage.getItem('user_name');

            if (!userName || !userRole) {
                alert('Please login to access the teacher dashboard.');
                window.location.href = 'auth.html?role=teacher';
                return false;
            }

            if (userRole !== 'teacher') {
                alert(`Access denied. You are logged in as ${userRole}.`);
                window.location.href = 'auth.html?role=teacher';
                return false;
            }

            return true;
        }

        // Display user information
        function displayUserInfo() {
            const userName = localStorage.getItem('user_name');
            const userRole = localStorage.getItem('user_role');

            if (userName) {
                document.getElementById('teacher-name-display').textContent = userName;
                document.getElementById('header-user-name').textContent = userName;
                document.getElementById('header-user-role').textContent = userRole || 'Teacher';
                document.getElementById('greeting-message').textContent = `Welcome back, ${userName}!`;

                const avatar = document.getElementById('user-avatar');
                if (avatar) {
                    const initials = userName
                        .split(' ')
                        .map(word => word.charAt(0).toUpperCase())
                        .join('')
                        .substring(0, 2);
                    avatar.textContent = initials;
                }
            }
        }

        // Activity logging functions
        function logActivity(description, type = 'quiz') {
            const activities = JSON.parse(localStorage.getItem('teacher_activities') || '[]');

            const newActivity = {
                id: Date.now(),
                description: description,
                type: type,
                time: new Date().toLocaleTimeString(),
                date: new Date().toLocaleDateString(),
                timestamp: Date.now()
            };

            activities.unshift(newActivity);

            if (activities.length > 10) {
                activities.pop();
            }

            localStorage.setItem('teacher_activities', JSON.stringify(activities));
            loadRecentActivity();
        }

        // Load recent activity
        async function loadRecentActivity() {
            try {
                const activities = JSON.parse(localStorage.getItem('teacher_activities') || '[]');

                const activityLog = document.getElementById('recent-activity-log');
                if (activities.length > 0) {
                    let html = '';
                    activities.forEach(activity => {
                        let icon = 'fa-list-check';
                        let bgColor = 'var(--primary)';

                        if (activity.type === 'student') {
                            icon = 'fa-user';
                            bgColor = 'var(--info)';
                        } else if (activity.type === 'quiz') {
                            icon = 'fa-list-check';
                            if (activity.description.includes('deleted') || activity.description.includes('Deleted')) {
                                icon = 'fa-trash';
                                bgColor = 'var(--error)';
                            } else if (activity.description.includes('added') || activity.description.includes('Added')) {
                                icon = 'fa-plus';
                                bgColor = 'var(--success)';
                            } else if (activity.description.includes('updated') || activity.description.includes('Updated')) {
                                icon = 'fa-edit';
                                bgColor = 'var(--warning)';
                            }
                        }

                        html += `
                    <div class="activity-item">
                        <div class="activity-icon" style="background-color: ${bgColor};">
                            <i class="fas ${icon}"></i>
                        </div>
                        <div class="activity-details">
                            <div class="activity-text">${activity.description}</div>
                            <div class="activity-time">${activity.time}  ${activity.date}</div>
                        </div>
                    </div>
                `;
                    });
                    activityLog.innerHTML = html;
                } else {
                    const userName = localStorage.getItem('user_name') || 'Teacher';
                    html = `
                <div class="activity-item">
                    <div class="activity-icon" style="background-color: var(--primary);">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-text">${userName} logged into teacher dashboard</div>
                        <div class="activity-time">Just now</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon" style="background-color: var(--success);">
                        <i class="fas fa-list-check"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-text">Welcome to QuizPro Teacher Dashboard</div>
                        <div class="activity-time">Today</div>
                    </div>
                </div>
            `;
                    activityLog.innerHTML = html;
                }
            } catch (error) {
                console.error('Error loading recent activity:', error);
            }
        }

        // ===============================
        // DOM Elements
        // ===============================
        const sidebarLinks = document.querySelectorAll('.sidebar-link');
        const contentSections = document.querySelectorAll('.content-section');
        const logoutLink = document.getElementById('logout-link');
        const headerTitle = document.getElementById('header-title');
        const breadcrumbCurrent = document.getElementById('breadcrumb-current');
        const menuToggle = document.querySelector('.menu-toggle');
        const closeSidebar = document.querySelector('.close-sidebar');
        const dashboardSidebar = document.querySelector('.dashboard-sidebar');
        const themeSelect = document.getElementById('theme-select');
        const addQuizBtn = document.getElementById('add-quiz-btn');
        const addQuestionBtn = document.getElementById('add-question-btn');
        const quizSearch = document.getElementById('quiz-search');
        const studentSearch = document.getElementById('student-search');
        const questionSearch = document.getElementById('question-search');

        // ===============================
        // Initialize the dashboard
        // ===============================
        document.addEventListener('DOMContentLoaded', function () {
            if (!checkAuth()) {
                return;
            }

            displayUserInfo();
            const userName = localStorage.getItem('user_name') || 'Teacher';
            logActivity(`${userName} logged into teacher dashboard`, 'quiz');

            const hash = window.location.hash || '#overview';
            showContent(hash.substring(1));

            loadTeacherStats();
            loadRecentActivity();
            loadTeacherQuizzes();
            loadStudents();
            loadQuestions();

            sidebarLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();

                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');

                    const contentId = this.getAttribute('data-content');
                    showContent(contentId);
                    window.location.hash = contentId;

                    if (window.innerWidth <= 768) {
                        dashboardSidebar.classList.remove('mobile-open');
                    }

                    switch (contentId) {
                        case 'overview':
                            loadTeacherStats();
                            loadRecentActivity();
                            break;
                        case 'my-quizzes':
                            loadTeacherQuizzes();
                            break;
                        case 'my-students':
                            loadStudents();
                            break;
                        case 'question-bank':
                            loadQuestions();
                            break;
                        case 'settings':
                            loadSettings();
                            break;
                    }
                });
            });

            logoutLink.addEventListener('click', function (e) {
                e.preventDefault();
                if (confirm('Are you sure you want to logout?')) {
                    localStorage.removeItem('user_name');
                    localStorage.removeItem('user_role');
                    localStorage.removeItem('user_id');
                    window.location.href = 'auth.html?role=teacher';
                }
            });

            if (quizSearch) {
                quizSearch.addEventListener('input', function () {
                    filterQuizzes(this.value);
                });
            }

            if (studentSearch) {
                studentSearch.addEventListener('input', function () {
                    filterStudents(this.value);
                });
            }

            if (questionSearch) {
                questionSearch.addEventListener('input', function () {
                    filterQuestions(this.value);
                });
            }

            setupModalFunctionality();

            menuToggle.addEventListener('click', function () {
                dashboardSidebar.classList.toggle('mobile-open');
            });

            closeSidebar.addEventListener('click', function () {
                dashboardSidebar.classList.remove('mobile-open');
            });

            if (themeSelect) {
                const savedTheme = localStorage.getItem('quizpro-theme') || 'light';
                themeSelect.value = savedTheme;
                setTheme(savedTheme);

                themeSelect.addEventListener('change', function () {
                    setTheme(this.value);
                    localStorage.setItem('quizpro-theme', this.value);
                });
            }

            window.addEventListener('resize', function () {
                if (window.innerWidth > 768) {
                    dashboardSidebar.classList.remove('mobile-open');
                }
            });
        });

        // ===============================
        // Core Functions
        // ===============================

        // Show content section
        function showContent(contentId) {
            contentSections.forEach(section => {
                section.classList.remove('active-content');
                section.classList.add('hidden-content');
            });

            const activeSection = document.getElementById(contentId);
            if (activeSection) {
                activeSection.classList.add('active-content');
                activeSection.classList.remove('hidden-content');
                updateHeader(contentId);
            }
        }

        // Update header based on current section
        function updateHeader(sectionId) {
            const sectionTitles = {
                'overview': 'Teacher Dashboard',
                'my-quizzes': 'All Quizzes',
                'my-students': 'My Students',
                'question-bank': 'Question Bank',
                'settings': 'Teacher Settings'
            };

            const breadcrumbTitles = {
                'overview': 'Overview',
                'my-quizzes': 'All Quizzes',
                'my-students': 'My Students',
                'question-bank': 'Question Bank',
                'settings': 'Settings'
            };

            headerTitle.textContent = sectionTitles[sectionId] || 'Dashboard';
            breadcrumbCurrent.textContent = breadcrumbTitles[sectionId] || 'Dashboard';
        }

        // Load teacher statistics
        async function loadTeacherStats() {
            try {
                // Use the existing admin stats API (simplified)
                const response = await fetch("http://localhost/quiz_php-main/api/dashboard_stats.php");
                const data = await response.json();

                if (data.success) {
                    document.getElementById('active-quizzes-count').textContent = data.total_quizzes || 0;
                    document.getElementById('total-students-count').textContent = data.total_users || 0;
                    document.getElementById('total-questions-count').textContent = data.total_questions || 0;
                    document.getElementById('pending-grading-count').textContent = 0; // Simplified
                }
            } catch (error) {
                console.error('Error loading teacher stats:', error);
            }
        }

        // Load teacher quizzes (ALL quizzes)
        async function loadTeacherQuizzes() {
            try {
                // Use the existing get_quizzes.php API (shows all quizzes)
                const response = await fetch("http://localhost/quiz_php-main/api/get_quizzes.php");
                const data = await response.json();

                console.log('Teacher Quizzes API response:', data);

                const quizTableBody = document.getElementById('quiz-table-body');
                if (data.success && data.quizzes.length > 0) {
                    let html = '';
                    data.quizzes.forEach(quiz => {
                        const title = quiz.title || 'Untitled Quiz';
                        const subject = quiz.subject || 'General';
                        const totalQuestions = quiz.total_questions || 0;
                        const totalMarks = quiz.total_marks || 100;
                        const timeLimit = quiz.time_limit || 60;
                        const createdAt = quiz.created_at ? new Date(quiz.created_at).toLocaleDateString() : 'N/A';

                        html += `
                            <tr>
                                <td>${quiz.id}</td>
                                <td>${title}</td>
                                <td>${subject}</td>
                                <td>${totalQuestions}</td>
                                <td>${totalMarks}</td>
                                <td>${timeLimit} min</td>
                                <td>${createdAt}</td>
                                <td class="action-buttons">
                                    <button class="edit-btn" onclick="openEditQuizModal(${quiz.id})">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="edit-btn" onclick="openManageQuestionsModal(${quiz.id}, '${title.replace(/'/g, "\\'")}')" style="background-color: var(--info);">
                                        <i class="fas fa-question-circle"></i> Questions
                                    </button>
                                    <button class="delete-btn" onclick="openDeleteQuizModal(${quiz.id}, '${title.replace(/'/g, "\\'")}')">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                        `;
                    });
                    quizTableBody.innerHTML = html;

                    // Update stats
                    document.getElementById('published-quizzes-count').textContent = data.quizzes.length;
                    document.getElementById('quiz-questions-count').textContent = data.quizzes.reduce((sum, quiz) => sum + (parseInt(quiz.total_questions) || 0), 0);

                } else {
                    quizTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">No quizzes found. Create your first quiz!</td></tr>';
                    document.getElementById('published-quizzes-count').textContent = '0';
                    document.getElementById('quiz-questions-count').textContent = '0';
                }
            } catch (error) {
                console.error('Error loading teacher quizzes:', error);
                const quizTableBody = document.getElementById('quiz-table-body');
                quizTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--error);">Error loading quizzes. Please try again.</td></tr>';
            }
        }

        // Load students
        async function loadStudents() {
            try {
                // Use the existing get_users.php API
                const response = await fetch("http://localhost/quiz_php-main/api/get_users.php");
                const data = await response.json();

                const studentTableBody = document.getElementById('student-table-body');
                if (data.success && data.users.length > 0) {
                    let html = '';
                    // Filter only students
                    const students = data.users.filter(user => user.role === 'student');
                    
                    students.forEach(student => {
                        html += `
                            <tr>
                                <td>${student.id}</td>
                                <td>${student.name}</td>
                                <td>${student.email}</td>
                                <td>${student.created_at || 'Never'}</td>
                                
                            </tr>
                        `;
                    });
                    studentTableBody.innerHTML = html;

                    // Update stats
                    document.getElementById('students-count').textContent = students.length;
                    document.getElementById('active-students-count').textContent = students.length;
                    document.getElementById('avg-performance').textContent = '0%';

                } else {
                    studentTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No students found.</td></tr>';
                    document.getElementById('students-count').textContent = '0';
                    document.getElementById('active-students-count').textContent = '0';
                    document.getElementById('avg-performance').textContent = '0%';
                }
            } catch (error) {
                console.error('Error loading students:', error);
            }
        }

        // Load questions
        async function loadQuestions() {
            try {
                // Use existing API or create a simple one
                const response = await fetch("http://localhost/quiz_php-main/api/get_questions.php");
                const data = await response.json();

                const questionTableBody = document.getElementById('question-table-body');
                if (data.success && data.questions.length > 0) {
                    let html = '';
                    data.questions.forEach(question => {
                        html += `
                            <tr>
                                <td>${question.id}</td>
                                <td>${question.question_text.substring(0, 100)}${question.question_text.length > 100 ? '...' : ''}</td>
                                <td>${question.created_at ? new Date(question.created_at).toLocaleDateString() : 'N/A'}</td>
                                <td class="action-buttons">
                                    <button class="edit-btn" onclick="openEditQuestionModal(${question.id})">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="delete-btn" onclick="deleteQuestion(${question.id})">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                        `;
                    });
                    questionTableBody.innerHTML = html;

                } else {
                    questionTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No questions found. Add your first question!</td></tr>';
                }
            } catch (error) {
                console.error('Error loading questions:', error);
            }
        }

        // Load settings
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('teacher_settings') || '{}');
            
            if (settings.notifications) {
                document.getElementById('notif-quiz-submissions').checked = settings.notifications.quiz_submissions !== false;
                document.getElementById('notif-student-questions').checked = settings.notifications.student_questions !== false;
                document.getElementById('notif-system-updates').checked = settings.notifications.system_updates || false;
            }
            
            if (settings.language) {
                document.getElementById('language-select').value = settings.language;
            }
        }

        // Set theme
        function setTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else if (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
            }
        }

        // Setup modal functionality
        function setupModalFunctionality() {
            // Add Quiz Modal
            if (addQuizBtn) {
                addQuizBtn.addEventListener('click', function () {
                    document.getElementById('add-quiz-form').reset();
                    openModal('add-quiz-modal');
                });
            }

            // Add Question Modal (from question bank)
            if (addQuestionBtn) {
                addQuestionBtn.addEventListener('click', function () {
                    document.getElementById('question-form').reset();
                    document.getElementById('question-modal-title').textContent = 'Add Question';
                    document.getElementById('question-quiz-id').value = ''; // No quiz ID for general questions
                    openModal('question-modal');
                });
            }

            // Add Question to Quiz button
            const addQuizQuestionBtn = document.getElementById('add-quiz-question-btn');
            if (addQuizQuestionBtn) {
                addQuizQuestionBtn.addEventListener('click', function () {
                    const quizId = document.getElementById('manage-questions-modal').dataset.quizId;
                    document.getElementById('question-form').reset();
                    document.getElementById('question-quiz-id').value = quizId;
                    document.getElementById('question-modal-title').textContent = 'Add Question to Quiz';
                    closeModal(document.getElementById('manage-questions-modal'));
                    openModal('question-modal');
                });
            }

            // Setup all close buttons
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function () {
                    closeModal(this.closest('.modal'));
                });
            });

            document.querySelectorAll('.cancel-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    closeModal(this.closest('.modal'));
                });
            });

            // Close modal when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function (e) {
                    if (e.target === this) {
                        closeModal(this);
                    }
                });
            });

            // Quiz Save Button
            const saveQuizBtn = document.querySelector('#add-quiz-modal .save-btn');
            if (saveQuizBtn) {
                saveQuizBtn.addEventListener('click', async function (e) {
                    e.preventDefault();
                    await createQuiz();
                });
            }

            // Quiz Form Submission
            const addQuizForm = document.getElementById('add-quiz-form');
            if (addQuizForm) {
                addQuizForm.addEventListener('submit', async function (e) {
                    e.preventDefault();
                    await createQuiz();
                });
            }

            // Save Question Button
            const saveQuestionBtn = document.getElementById('save-question-btn');
            if (saveQuestionBtn) {
                saveQuestionBtn.addEventListener('click', async function (e) {
                    e.preventDefault();
                    await saveQuestion();
                });
            }

            // Question Form Submission
            const questionForm = document.getElementById('question-form');
            if (questionForm) {
                questionForm.addEventListener('submit', async function (e) {
                    e.preventDefault();
                    await saveQuestion();
                });
            }

            // Save Settings Button
            const saveSettingsBtn = document.getElementById('save-settings-btn');
            if (saveSettingsBtn) {
                saveSettingsBtn.addEventListener('click', saveSettings);
            }

            // Cancel Settings Button
            const cancelSettingsBtn = document.getElementById('cancel-settings-btn');
            if (cancelSettingsBtn) {
                cancelSettingsBtn.addEventListener('click', function () {
                    loadSettings(); // Reset to saved settings
                });
            }

            // Escape key to close modals
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.active').forEach(modal => {
                        closeModal(modal);
                    });
                }
            });
        }

        // Open modal function
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        // Close modal function
        function closeModal(modal) {
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        // Filter quizzes
        function filterQuizzes(searchTerm) {
            const tableBody = document.getElementById('quiz-table-body');
            const rows = tableBody.getElementsByTagName('tr');

            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;

                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent || cells[j].innerText;
                    if (cellText.toLowerCase().includes(searchTerm.toLowerCase())) {
                        found = true;
                        break;
                    }
                }

                rows[i].style.display = found ? '' : 'none';
            }
        }

        // Filter students
        function filterStudents(searchTerm) {
            const tableBody = document.getElementById('student-table-body');
            const rows = tableBody.getElementsByTagName('tr');

            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;

                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent || cells[j].innerText;
                    if (cellText.toLowerCase().includes(searchTerm.toLowerCase())) {
                        found = true;
                        break;
                    }
                }

                rows[i].style.display = found ? '' : 'none';
            }
        }

        // Filter questions
        function filterQuestions(searchTerm) {
            const tableBody = document.getElementById('question-table-body');
            const rows = tableBody.getElementsByTagName('tr');

            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;

                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent || cells[j].innerText;
                    if (cellText.toLowerCase().includes(searchTerm.toLowerCase())) {
                        found = true;
                        break;
                    }
                }

                rows[i].style.display = found ? '' : 'none';
            }
        }

        // ===============================
        // Quiz Functions
        // ===============================

        // Create new quiz
        async function createQuiz() {
            const title = document.getElementById('quiz-title').value;
            const subject = document.getElementById('quiz-subject').value;
            const totalQuestions = document.getElementById('quiz-total-questions').value || 10;
            const totalMarks = document.getElementById('quiz-total-marks').value || 100;
            const timeLimit = document.getElementById('quiz-time-limit').value || 60;

            // Validation
            if (!title || !subject) {
                alert('Please fill all required fields');
                return;
            }

            try {
                const saveBtn = document.querySelector('#add-quiz-modal .save-btn');
                const originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
                saveBtn.disabled = true;

                const quizData = {
                    title: title,
                    subject: subject,
                    total_questions: parseInt(totalQuestions),
                    total_marks: parseInt(totalMarks),
                    time_limit: parseInt(timeLimit)
                };

                console.log('Creating quiz with data:', quizData);

                const response = await fetch("http://localhost/quiz_php-main/api/create_quiz.php", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(quizData)
                });

                const data = await response.json();
                console.log('Create quiz response:', data);

                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;

                if (data.success) {
                    logActivity(`Created new quiz: ${title}`, 'quiz');
                    alert('Quiz created successfully!');
                    closeModal(document.getElementById('add-quiz-modal'));
                    document.getElementById('add-quiz-form').reset();
                    loadTeacherQuizzes();
                    loadTeacherStats();
                } else {
                    alert('Error creating quiz: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error creating quiz:', error);
                const saveBtn = document.querySelector('#add-quiz-modal .save-btn');
                saveBtn.innerHTML = 'Create Quiz';
                saveBtn.disabled = false;
                alert('Network error: Could not connect to server. Please try again.');
            }
        }

        // Open Edit Quiz Modal
        async function openEditQuizModal(quizId) {
            try {
                const response = await fetch(`http://localhost/quiz_php-main/api/get_quiz.php?id=${quizId}`);
                const data = await response.json();

                console.log('Edit quiz data:', data);

                if (data.success) {
                    const quiz = data.quiz;
                    document.getElementById('edit-quiz-id').value = quiz.id;
                    document.getElementById('edit-quiz-title').value = quiz.title || '';
                    document.getElementById('edit-quiz-subject').value = quiz.subject || '';
                    document.getElementById('edit-quiz-total-questions').value = quiz.total_questions || 0;
                    document.getElementById('edit-quiz-total-marks').value = quiz.total_marks || 100;
                    document.getElementById('edit-quiz-time-limit').value = quiz.time_limit || 60;
                    openModal('edit-quiz-modal');
                    setupQuizUpdateButton(quizId);
                } else {
                    alert('Error loading quiz data: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error loading quiz:', error);
                alert('Error loading quiz data: ' + error.message);
            }
        }

        // Setup quiz update button
        function setupQuizUpdateButton(quizId) {
            const updateBtn = document.querySelector('#edit-quiz-modal .save-btn');
            const newUpdateBtn = updateBtn.cloneNode(true);
            updateBtn.parentNode.replaceChild(newUpdateBtn, updateBtn);

            newUpdateBtn.addEventListener('click', async function (e) {
                e.preventDefault();
                await updateQuiz(quizId);
            });

            const editForm = document.getElementById('edit-quiz-form');
            editForm.onsubmit = async function (e) {
                e.preventDefault();
                await updateQuiz(quizId);
            };
        }

        // Update quiz
        async function updateQuiz(quizId) {
            const title = document.getElementById('edit-quiz-title').value;
            const subject = document.getElementById('edit-quiz-subject').value;
            const totalQuestions = document.getElementById('edit-quiz-total-questions').value;
            const totalMarks = document.getElementById('edit-quiz-total-marks').value;
            const timeLimit = document.getElementById('edit-quiz-time-limit').value;

            // Validation
            if (!title || !subject || !totalQuestions || !totalMarks || !timeLimit) {
                alert('Please fill all required fields');
                return;
            }

            try {
                const updateBtn = document.querySelector('#edit-quiz-modal .save-btn');
                const originalText = updateBtn.innerHTML;
                updateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
                updateBtn.disabled = true;

                const quizData = {
                    id: parseInt(quizId),
                    title: title,
                    subject: subject,
                    total_questions: parseInt(totalQuestions),
                    total_marks: parseInt(totalMarks),
                    time_limit: parseInt(timeLimit)
                };

                console.log('Updating quiz with data:', quizData);

                const response = await fetch("http://localhost/quiz_php-main/api/update_quiz.php", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(quizData)
                });

                const data = await response.json();
                console.log('Update quiz response:', data);

                updateBtn.innerHTML = originalText;
                updateBtn.disabled = false;

                if (data.success) {
                    logActivity(`Updated quiz: ${title}`, 'quiz');
                    alert('Quiz updated successfully!');
                    closeModal(document.getElementById('edit-quiz-modal'));
                    loadTeacherQuizzes();
                } else {
                    alert('Error updating quiz: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error updating quiz:', error);
                const updateBtn = document.querySelector('#edit-quiz-modal .save-btn');
                updateBtn.innerHTML = 'Update Quiz';
                updateBtn.disabled = false;
                alert('Network error: Could not connect to server. Please try again.');
            }
        }

        // Open Delete Quiz Modal
        function openDeleteQuizModal(quizId, quizTitle) {
            document.getElementById('delete-quiz-id').value = quizId;
            document.getElementById('delete-quiz-title').textContent = quizTitle;
            openModal('delete-quiz-modal');
            setupQuizDeleteButton();
        }

        // Setup quiz delete button
        function setupQuizDeleteButton() {
            const deleteBtn = document.querySelector('#delete-quiz-modal .delete-btn');
            const newDeleteBtn = deleteBtn.cloneNode(true);
            deleteBtn.parentNode.replaceChild(newDeleteBtn, deleteBtn);

            newDeleteBtn.addEventListener('click', async function (e) {
                e.preventDefault();
                await deleteQuiz();
            });
        }

        // Delete quiz
        async function deleteQuiz() {
            const quizId = document.getElementById('delete-quiz-id').value;
            const quizTitle = document.getElementById('delete-quiz-title').textContent;

            if (!quizId) {
                alert('No quiz selected');
                return;
            }

            try {
                const deleteBtn = document.querySelector('#delete-quiz-modal .delete-btn');
                const originalText = deleteBtn.innerHTML;
                deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
                deleteBtn.disabled = true;

                const response = await fetch("http://localhost/quiz_php-main/api/delete_quiz.php", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        id: parseInt(quizId)
                    })
                });

                const data = await response.json();

                deleteBtn.innerHTML = originalText;
                deleteBtn.disabled = false;

                if (data.success) {
                    logActivity(`Deleted quiz: ${quizTitle}`, 'quiz');
                    alert('Quiz deleted successfully!');
                    closeModal(document.getElementById('delete-quiz-modal'));
                    loadTeacherQuizzes();
                    loadTeacherStats();
                } else {
                    alert('Error deleting quiz: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error deleting quiz:', error);
                const deleteBtn = document.querySelector('#delete-quiz-modal .delete-btn');
                deleteBtn.innerHTML = 'Delete Quiz';
                deleteBtn.disabled = false;
                alert('Network error: Could not connect to server. Please try again.');
            }
        }

        // Open Manage Questions Modal
        async function openManageQuestionsModal(quizId, quizTitle) {
            document.getElementById('quiz-title-display').textContent = quizTitle;
            document.getElementById('manage-questions-modal').dataset.quizId = quizId;
            openModal('manage-questions-modal');
            await loadQuizQuestions(quizId);
        }

        // Load questions for a quiz
        async function loadQuizQuestions(quizId) {
            try {
                const response = await fetch(`http://localhost/quiz_php-main/api/get_questions.php?quiz_id=${quizId}`);
                const data = await response.json();

                const questionsContainer = document.getElementById('questions-container');
                if (data.success && data.questions.length > 0) {
                    let html = '<div class="questions-list">';
                    data.questions.forEach((question, index) => {
                        html += `
                            <div class="question-item">
                                <div class="question-header">
                                    <h4>Question ${index + 1}</h4>
                                    <div class="question-actions">
                                        <button class="edit-btn" onclick="openEditQuestionModal(${question.id})">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button class="delete-btn" onclick="deleteQuestion(${question.id})">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </div>
                                <p><strong>Question:</strong> ${question.question_text}</p>
                                <div class="options-grid">
                                    <div class="option ${question.correct_option === 'a' ? 'correct' : ''}">
                                        <strong>A:</strong> ${question.option_a}
                                    </div>
                                    <div class="option ${question.correct_option === 'b' ? 'correct' : ''}">
                                        <strong>B:</strong> ${question.option_b}
                                    </div>
                                    <div class="option ${question.correct_option === 'c' ? 'correct' : ''}">
                                        <strong>C:</strong> ${question.option_c || ''}
                                    </div>
                                    <div class="option ${question.correct_option === 'd' ? 'correct' : ''}">
                                        <strong>D:</strong> ${question.option_d || ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    questionsContainer.innerHTML = html;
                } else {
                    questionsContainer.innerHTML = '<div style="text-align: center; padding: 20px;">No questions found. Add your first question!</div>';
                }
            } catch (error) {
                console.error('Error loading questions:', error);
                questionsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--error);">Error loading questions.</div>';
            }
        }

        // Open Edit Question Modal
        async function openEditQuestionModal(questionId) {
            try {
                const response = await fetch(`http://localhost/quiz_php-main/api/get_question.php?id=${questionId}`);
                const data = await response.json();

                if (data.success) {
                    const question = data.question;
                    document.getElementById('question-modal-title').textContent = 'Edit Question';
                    document.getElementById('question-id').value = question.id;
                    document.getElementById('question-quiz-id').value = question.quiz_id || '';
                    document.getElementById('question-text').value = question.question_text;
                    document.getElementById('option-a').value = question.option_a;
                    document.getElementById('option-b').value = question.option_b;
                    document.getElementById('option-c').value = question.option_c || '';
                    document.getElementById('option-d').value = question.option_d || '';
                    document.getElementById('correct-option').value = question.correct_option;
                    openModal('question-modal');
                }
            } catch (error) {
                console.error('Error loading question:', error);
                alert('Error loading question data');
            }
        }

        // Save Question
        async function saveQuestion() {
            const questionId = document.getElementById('question-id').value;
            const quizId = document.getElementById('question-quiz-id').value;
            const questionText = document.getElementById('question-text').value;
            const optionA = document.getElementById('option-a').value;
            const optionB = document.getElementById('option-b').value;
            const optionC = document.getElementById('option-c').value;
            const optionD = document.getElementById('option-d').value;
            const correctOption = document.getElementById('correct-option').value;

            if (!questionText || !optionA || !optionB || !correctOption) {
                alert('Please fill all required fields');
                return;
            }

            const url = questionId ?
                "http://localhost/quiz_php-main/api/update_question.php" :
                "http://localhost/quiz_php-main/api/add_question.php";

            const method = questionId ? "PUT" : "POST";

            try {
                const saveBtn = document.getElementById('save-question-btn');
                const originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                saveBtn.disabled = true;

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        id: questionId || null,
                        quiz_id: quizId || null,
                        question_text: questionText,
                        option_a: optionA,
                        option_b: optionB,
                        option_c: optionC,
                        option_d: optionD,
                        correct_option: correctOption
                    })
                });

                const data = await response.json();

                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;

                if (data.success) {
                    alert(questionId ? 'Question updated successfully!' : 'Question added successfully!');
                    closeModal(document.getElementById('question-modal'));

                    if (quizId) {
                        const currentQuizId = document.getElementById('manage-questions-modal').dataset.quizId;
                        await loadQuizQuestions(currentQuizId);
                    }
                    loadQuestions();
                    loadTeacherStats();
                } else {
                    alert('Error: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving question:', error);
                alert('Network error: Could not connect to server.');
            }
        }

        // Delete Question
        async function deleteQuestion(questionId) {
            if (!confirm('Are you sure you want to delete this question?')) {
                return;
            }

            try {
                const response = await fetch("http://localhost/quiz_php-main/api/delete_question.php", {
                    method: "DELETE",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ id: questionId })
                });

                const data = await response.json();

                if (data.success) {
                    alert('Question deleted successfully!');
                    loadQuestions();
                    loadTeacherStats();
                } else {
                    alert('Error: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error deleting question:', error);
                alert('Network error: Could not connect to server.');
            }
        }

        // View Student Profile
        function viewStudentProfile(studentId) {
            alert(`Student profile view functionality would be implemented here for student ID: ${studentId}`);
            // In a real application, this would open a modal or new page with student details
        }

        // Save Settings
        function saveSettings() {
            const settings = {
                notifications: {
                    quiz_submissions: document.getElementById('notif-quiz-submissions').checked,
                    student_questions: document.getElementById('notif-student-questions').checked,
                    system_updates: document.getElementById('notif-system-updates').checked
                },
                language: document.getElementById('language-select').value
            };

            localStorage.setItem('teacher_settings', JSON.stringify(settings));
            alert('Settings saved successfully!');
        }

        // Make functions available globally
        window.openEditQuizModal = openEditQuizModal;
        window.openManageQuestionsModal = openManageQuestionsModal;
        window.openDeleteQuizModal = openDeleteQuizModal;
        window.openEditQuestionModal = openEditQuestionModal;
        window.deleteQuestion = deleteQuestion;
        window.viewStudentProfile = viewStudentProfile;
    </script>
</body>
</html>